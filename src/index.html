<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>功夫淘微商店</title>
    <meta content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0" name="viewport" />
    <meta content="yes" name="apple-mobile-web-app-capable" />
    <meta content="black" name="apple-mobile-web-app-status-bar-style" />
    <meta content="telephone=no" name="format-detection" />
    <!-- YDUI库 -->
    <link rel="stylesheet" href="./css/ydui.css?rev=@@hash" />
    <link rel="stylesheet" href="./css/mescroll.min.css" />
    <!-- css -->
    <link rel="stylesheet" href="./css/index.css" />
    <script src="./js/ydui.flexible.js"></script>
</head>

<body>
    <section class="g-flexview">
        <!-- header -->
        <header class="m-navbar">
            <a href="classify.html" class="class_ify">
                <img src="./images/ico_classify.png" alt="">
            </a>
            <div class="search_box">
                <input disabled id="search" type="text" value="" placeholder="搜索您想要的商品名称">
                <img src="./images/ico_search.png" alt="">
            </div>
            <a href="/message.html" class="msg">
                <img src="./images/ico_msg.png" alt="">
                <span class="badge badge-danger">2</span>
            </a>
        </header>
        <!-- main -->
        <section class="mescroll" id="mescroll">
            <div class="mescroll-bounce">
                <!--slider-->
                <div class="m-slider" data-ydui-slider="{autoplay: 3000}"><!-- 参数在这里 -->
                    <div class="slider-wrapper">
                        <div class="slider-item">
                            <a href="#">
                                <img src="http://static.ydcss.com/uploads/ydui/1.jpg">
                            </a>
                        </div>
                        <div class="slider-item">
                            <a href="#">
                                <img src="http://static.ydcss.com/uploads/ydui/2.jpg">
                            </a>
                        </div>
                        <div class="slider-item">
                            <a href="#">
                                <img src="http://static.ydcss.com/uploads/ydui/3.jpg">
                            </a>
                        </div>
                    </div>
                    <div class="slider-pagination"></div>
                    <!-- 分页标识 -->
                </div>
                
                <!--分类-->
                <div class="classify">
                    <div class="m-grids-4">
                        <a href="assess.html" class="grids-item">
                            <div class="grids-icon"><img src="images/ico_classify_1.png"></div>
                            <div class="grids-txt"><span>服装</span></div>
                        </a>
                        <a href="more_classify.html" class="grids-item">
                            <div class="grids-icon"><img src="images/ico_classify_2.png"></div>
                            <div class="grids-txt"><span>箱包</span></div>
                        </a>
                        <a href="classify.html" class="grids-item">
                            <div class="grids-icon"><img src="images/ico_classify_3.png"></div>
                            <div class="grids-txt"><span>数码/手机</span></div>
                        </a>
                        <a href="goods_detail.html" class="grids-item">
                            <div class="grids-icon"><img src="images/ico_classify_4.png"></div>
                            <div class="grids-txt"><span>运动</span></div>
                        </a>
                        <a href="order_other.html" class="grids-item">
                            <div class="grids-icon"><img src="images/ico_classify_5.png"></div>
                            <div class="grids-txt"><span>美食/茶酒</span></div>
                        </a>
                        <a href="refund.html" class="grids-item">
                            <div class="grids-icon"><img src="images/ico_classify_6.png"></div>
                            <div class="grids-txt"><span>化妆品</span></div>
                        </a>
                        <a href="suggestion.html" class="grids-item">
                            <div class="grids-icon"><img src="images/ico_classify_7.png"></div>
                            <div class="grids-txt"><span>饰品</span></div>
                        </a>
                        <a href="address_lists.html" class="grids-item">
                            <div class="grids-icon"><img src="images/ico_classify_8.png"></div>
                            <div class="grids-txt"><span>畅销热卖</span></div>
                        </a>
                    </div>
                </div>
                
                <div class="hot">
                    <div class="m-grids-2">
                        <a href="#" class="grids-item">
                            <img class="hot_img" src="images/hot.png" alt="">
                        </a>
                        <a href="#" class="grids-item">
                            <img src="images/about.png" alt="">
                        </a>
                    </div>
                    <div class="m-grids-1">
                        <a href="#" class="grids-item">
                            <img src="images/hot1.png" alt="">
                        </a>
                    </div>
                </div>
                
                <!--展示上拉加载的数据列表-->
                <ul id="dataList" class="m-list list-theme1">
                    <!--<li>
						<a href="#" class="list-item">
                            <div class="list-img">
                                <img src="http://img1.shikee.com/try/2016/06/19/09430120929215230041.jpg_220x220.jpg">
                            </div>
                            <div class="list-mes">
                                <h3 class="list-title">标题标题标题标题标题</h3>
                                <div class="list-mes-item">
                                    <div>
                                        <span class="list-price"><em>¥</em>34.7</span>
                                        <span class="list-del-price">(已售100件)</span>
                                    </div>
                                    <div>right</div>
                                </div>
                            </div>
                        </a>
					</li>-->
                </ul>
            </div>
        </section>
    </section>
    
    <footer class="m-tabbar" style="position: fixed; bottom: 0; left: 0;">
        <a href="#" class="tabbar-item tabbar-active">
            <span class="tabbar-icon">
                <i class="ico_home"></i>
            </span>
            <span class="tabbar-txt">首页</span>
        </a>
        <a href="/classify.html" class="tabbar-item">
            <span class="tabbar-icon">
                <i class="ico_classify"></i>
            </span>
            <span class="tabbar-txt">分类</span>
        </a>
        <a href="#" class="tabbar-item">
            <span class="tabbar-icon">
                <i class="ico_car"></i>
            </span>
            <span class="tabbar-txt">购物车</span>
        </a>
        <a href="#" class="tabbar-item">
            <span class="tabbar-icon">
                <i class="ico_user"></i>
            </span>
            <span class="tabbar-txt">个人中心</span>
        </a>
    </footer>
</body>

<script src="http://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>
<script src="./js/ydui.citys.js"></script>
<script src="./js/ydui.js"></script>
<script src="./js/mescroll.min.js"></script>
<script src="./js/mescroll-option.js"></script>
<script>
    $(function () {
        //创建MeScroll对象
        var mescroll = initMeScroll('mescroll', {
            down: {
                auto: false, //是否在初始化完毕之后自动执行下拉回调callback; 默认true
                callback: downCallback //下拉刷新的回调
            },
            up: {
                auto: true, //初始化完毕,是否自动触发上拉加载的回调
                isBoth: false, //上拉加载时,如果滑动到列表顶部是否可以同时触发下拉刷新;默认false,两者不可同时触发; 这里为了演示改为true,不必等列表加载完毕才可下拉;
                callback: upCallback, //上拉加载的回调
                toTop: { //配置回到顶部按钮
                    src: '../images/mescroll-totop.png', //默认滚动到1000px显示,可配置offset修改
                    //offset : 1000
                }
            }
        });

        /*下拉刷新的回调 */
        function downCallback() {
            //加载轮播数据..
            //...
            //加载列表数据
            getListDataFromNet(0, 1, function (data) {
                //联网成功的回调,隐藏下拉刷新的状态
                mescroll.endSuccess();
                //设置列表数据
                setListData(data, false);
            }, function () {
                //联网失败的回调,隐藏下拉刷新的状态
                mescroll.endErr();
            });
        }

        /*上拉加载的回调 page = {num:1, size:10}; num:当前页 从1开始, size:每页数据条数 */
        function upCallback(page) {
            //联网加载数据
            getListDataFromNet(page.num, page.size, function (curPageData) {
                //联网成功的回调,隐藏下拉刷新和上拉加载的状态;
                //mescroll会根据传的参数,自动判断列表如果无任何数据,则提示空;列表无下一页数据,则提示无更多数据;
                console.log('page.num=' + page.num + ', page.size=' + page.size + ', curPageData.length=' + curPageData.length);

                //方法一(推荐): 后台接口有返回列表的总页数 totalPage
                //mescroll.endByPage(curPageData.length, totalPage); //必传参数(当前页的数据个数, 总页数)

                //方法二(推荐): 后台接口有返回列表的总数据量 totalSize
                //mescroll.endBySize(curPageData.length, totalSize); //必传参数(当前页的数据个数, 总数据量)

                //方法三(推荐): 您有其他方式知道是否有下一页 hasNext
                //mescroll.endSuccess(curPageData.length, hasNext); //必传参数(当前页的数据个数, 是否有下一页true/false)

                //方法四 (不推荐),会存在一个小问题:比如列表共有20条数据,每页加载10条,共2页.如果只根据当前页的数据个数判断,则需翻到第三页才会知道无更多数据,如果传了hasNext,则翻到第二页即可显示无更多数据.
                mescroll.endSuccess(curPageData.length);

                //设置列表数据
                setListData(curPageData, true);
            }, function () {
                //联网失败的回调,隐藏上拉加载的状态
                mescroll.endErr();
            });
        }

        /*设置列表数据*/
        function setListData(curPageData, isAppend) {
            var listDom = document.getElementById('dataList');
            for (var i = 0; i < curPageData.length; i++) {
                var pd = curPageData[i];

                var str = '<a href="goods_detail.html" class="list-item">';
                str += '    <div class="list-img">';
                str += '        <img src="' + pd.pdImg + '">';
                str += '    </div>';
                str += '    <div class="list-mes">';
                str += '        <h3 class="list-title">' + pd.pdName + '</h3>';
                str += '        <div class="list-mes-item">';
                str += '            <div>';
                str += '                <span class="list-price"><em>¥</em>' + pd.pdPrice + '</span>';
                str += '                <span class="list-del-price">(已售' + pd.pdSold + '件)</span>';
                str += '            </div>';
                str += '            <!--<div>right</div>-->';
                str += '        </div>';
                str += '    </div>';
                str += '</a>';

                var liDom = document.createElement('li');
                liDom.innerHTML = str;

                if (isAppend) {
                    listDom.appendChild(liDom); //加在列表的后面,上拉加载
                } else {
                    listDom.insertBefore(liDom, listDom.firstChild); //加在列表的前面,下拉刷新
                }
            }
        }

        /*联网加载列表数据*/
        function getListDataFromNet(pageNum, pageSize, successCallback, errorCallback) {
            //延时一秒,模拟联网
            setTimeout(function () {
                $.ajax({
                    type: 'GET',
                    url: 'data/data.json',
                    //url: '../res/pdlist1.json?num='+pageNum+'&size='+pageSize,
                    dataType: 'json',
                    success: function (data) {
                        var listData = [];

                        if (pageNum == 0) {
                            //此处模拟下拉刷新返回的数据
                            var i = Math.floor(Math.random() * data.length); //随机取一个商品返回
                            data[i].pdName = '【新增商品】 商品标题';
                            listData.push(data[i]);

                        } else {
                            //此处模拟上拉加载返回的数据 (模拟分页数据)
                            for (var i = (pageNum - 1) * pageSize; i < pageNum * pageSize; i++) {
                                if (i == data.length) break;
                                listData.push(data[i]);
                            }
                        }

                        //回调
                        successCallback(listData);
                    },
                    error: errorCallback
                });
            }, 2000)
        }

        //禁止PC浏览器拖拽图片,避免与下拉刷新冲突;如果仅在移动端使用,可删除此代码
        document.ondragstart = function () {
            return false;
        }
    });
</script>
<script>
    $(document).keyup(function(ev){
        if(ev.keyCode == 13) location.href = 'search.html';
    });
    $('.search_box').click(function(){
        location.href = 'search.html';
    })
</script>
</html>